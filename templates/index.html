<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Tracker - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        .glass-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-radius: 15px; padding: 30px; }
        .stat-card { text-align: center; padding: 20px; border-radius: 10px; margin: 10px; }
        .stat-number { font-size: 2.5rem; font-weight: bold; }
        .table-responsive { max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <div class="glass-card mt-4">
            <h1 class="text-center mb-4">‚è∞ Time Tracker Database</h1>
            <p class="lead text-center">–ö—É—Ä—Å–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ Flask + PostgreSQL + Render</p>
            
            <div class="row mb-4" id="stats-container">
                <div class="col-md-3">
                    <div class="stat-card bg-primary text-white">
                        <div class="stat-number" id="user-count">0</div>
                        <div>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card bg-success text-white">
                        <div class="stat-number" id="category-count">0</div>
                        <div>–ö–∞—Ç–µ–≥–æ—Ä–∏–π</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card bg-info text-white">
                        <div class="stat-number" id="event-count">0</div>
                        <div>–°–æ–±—ã—Ç–∏–π</div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card bg-warning text-white">
                        <div class="stat-number" id="template-count">0</div>
                        <div>–®–∞–±–ª–æ–Ω–æ–≤</div>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="card mb-4">
                        <div class="card-header bg-dark text-white">
                            <h5>üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="users-table">
                                    <thead>
                                        <tr><th>ID</th><th>–ò–º—è</th><th>Telegram</th></tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card mb-4">
                        <div class="card-header bg-dark text-white">
                            <h5>üìÖ –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="events-table">
                                    <thead>
                                        <tr><th>–¢–∏–ø</th><th>–í—Ä–µ–º—è</th><th>–î–ª–∏—Ç.</th></tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header bg-secondary text-white">
                    <h5>‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>API Endpoints:</h6>
                            <div class="btn-group-vertical w-100">
                                <a href="/api/stats" class="btn btn-outline-primary mb-2" target="_blank">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
                                <a href="/api/users" class="btn btn-outline-secondary mb-2" target="_blank">üë§ –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
                                <a href="/api/events" class="btn btn-outline-secondary mb-2" target="_blank">üìÖ –í—Å–µ —Å–æ–±—ã—Ç–∏—è</a>
                                <a href="/debug" class="btn btn-outline-info mb-2" target="_blank">üêõ –û—Ç–ª–∞–¥–∫–∞</a>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:</h6>
                            <button onclick="createTestData()" class="btn btn-success w-100 mb-2">
                                üöÄ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                            </button>
                            <button onclick="clearDatabase()" class="btn btn-danger w-100 mb-2">
                                üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ë–î
                            </button>
                            <small class="text-muted">–¢–æ–ª—å–∫–æ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏!</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-4 p-3 bg-light rounded">
                <h6>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ:</h6>
                <ul>
                    <li><strong>–°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π:</strong> Flask, PostgreSQL, SQLAlchemy, Render</li>
                    <li><strong>–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î:</strong> 4 —Ç–∞–±–ª–∏—Ü—ã (users, categories, events, templates)</li>
                    <li><strong>–¶–µ–ª—å:</strong> –¢—Ä–µ–∫–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–∏ (–ø–ª–∞–Ω vs —Ñ–∞–∫—Ç) —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π</li>
                    <li><strong>–ö—É—Ä—Å–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞</strong> –ø–æ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü–û –∏ –ë–î"</li>
                </ul>
                <div class="text-center mt-3">
                    <a href="https://render.com" target="_blank" class="btn btn-sm btn-outline-dark">Render</a>
                    <a href="https://flask.palletsprojects.com" target="_blank" class="btn btn-sm btn-outline-dark">Flask</a>
                    <a href="https://www.postgresql.org" target="_blank" class="btn btn-sm btn-outline-dark">PostgreSQL</a>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            loadStats();
            loadUsers();
            loadEvents();
        });
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();
                
                document.getElementById('user-count').textContent = data.users || 0;
                document.getElementById('category-count').textContent = data.categories || 0;
                document.getElementById('event-count').textContent = data.events || 0;
                document.getElementById('template-count').textContent = data.templates || 0;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        async function loadUsers() {
            try {
                const response = await fetch('/api/users');
                const users = await response.json();
                
                const tbody = document.querySelector('#users-table tbody');
                tbody.innerHTML = '';
                
                users.slice(0, 5).forEach(user => {
                    const row = `<tr>
                        <td>${user.id}</td>
                        <td>${user.name || '–ë–µ–∑ –∏–º–µ–Ω–∏'}</td>
                        <td>${user.telegram_id || '–ù–µ—Ç'}</td>
                    </tr>`;
                    tbody.innerHTML += row;
                });
                
                if (users.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="3" class="text-center">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</td></tr>';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
        async function loadEvents() {
            try {
                const response = await fetch('/api/events');
                const events = await response.json();
                
                const tbody = document.querySelector('#events-table tbody');
                tbody.innerHTML = '';
                
                events.slice(0, 5).forEach(event => {
                    const startTime = new Date(event.start_time).toLocaleTimeString('ru-RU');
                    const badge = event.type === 'plan' 
                        ? '<span class="badge bg-primary">–ø–ª–∞–Ω</span>'
                        : '<span class="badge bg-success">—Ñ–∞–∫—Ç</span>';
                    
                    const row = `<tr>
                        <td>${badge}</td>
                        <td>${startTime}</td>
                        <td>${event.duration || 0} –º–∏–Ω</td>
                    </tr>`;
                    tbody.innerHTML += row;
                });
                
                if (events.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="3" class="text-center">–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π</td></tr>';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–±—ã—Ç–∏–π:', error);
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        async function createTestData() {
            if (!confirm('–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ? –≠—Ç–æ –¥–æ–±–∞–≤–∏—Ç –∑–∞–ø–∏—Å–∏ –≤ –ë–î.')) return;
            
            try {
                const response = await fetch('/api/create-test-data', { method: 'POST' });
                const result = await response.json();
                
                alert(result.message || '–î–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω—ã!');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
                loadStats();
                loadUsers();
                loadEvents();
            } catch (error) {
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            }
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        async function clearDatabase() {
            if (!confirm('–í–ù–ò–ú–ê–ù–ò–ï! –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) return;
            
            try {
                const response = await fetch('/api/clear-db', { method: 'POST' });
                const result = await response.json();
                
                alert(result.message || '–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—á–∏—â–µ–Ω–∞');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
                loadStats();
                loadUsers();
                loadEvents();
            } catch (error) {
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            }
        }
        
        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
        setInterval(() => {
            loadStats();
        }, 10000);
    </script>
</body>
</html>
