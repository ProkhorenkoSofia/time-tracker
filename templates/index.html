<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Tracker - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background-color: #f8f9fa; }
        .card { margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .category-color { width: 20px; height: 20px; border-radius: 50%; display: inline-block; margin-right: 10px; }
        .stat-card { text-align: center; padding: 20px; }
        .stat-number { font-size: 2.5rem; font-weight: bold; color: #007bff; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">‚è∞ Time Tracker - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</h1>
        <p class="lead">–°–∏—Å—Ç–µ–º–∞ —É—á–µ—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ (–ø–ª–∞–Ω vs —Ñ–∞–∫—Ç)</p>
        
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="stat-number" id="user-count">0</div>
                    <div>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="stat-number" id="category-count">0</div>
                    <div>–ö–∞—Ç–µ–≥–æ—Ä–∏–π</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="stat-number" id="event-count">0</div>
                    <div>–°–æ–±—ã—Ç–∏–π</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="stat-number" id="template-count">0</div>
                    <div>–®–∞–±–ª–æ–Ω–æ–≤</div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</h5>
                    </div>
                    <div class="card-body">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>–¢–∞–±–ª–∏—Ü–∞</th>
                                    <th>–ó–∞–ø–∏—Å–µ–π</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                </tr>
                            </thead>
                            <tbody id="stats-table">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <h6>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:</h6>
                            <a href="/test-db" class="btn btn-outline-primary btn-sm me-2" target="_blank">–¢–µ—Å—Ç –ë–î</a>
                            <a href="/api/users" class="btn btn-outline-secondary btn-sm me-2" target="_blank">API –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</a>
                            <a href="/api/events" class="btn btn-outline-secondary btn-sm" target="_blank">API —Å–æ–±—ã—Ç–∏–π</a>
                        </div>
                        <div class="mb-3">
                            <h6>–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö:</h6>
                            <button onclick="createTestUser()" class="btn btn-success btn-sm me-2">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
                            <button onclick="createTestEvent()" class="btn btn-info btn-sm">–î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</button>
                        </div>
                        <div>
                            <h6>–°—Å—ã–ª–∫–∏:</h6>
                            <ul>
                                <li><a href="https://render.com/docs" target="_blank">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Render</a></li>
                                <li><a href="https://flask-sqlalchemy.palletsprojects.com/" target="_blank">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Flask-SQLAlchemy</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                <h5>üìù –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è</h5>
            </div>
            <div class="card-body">
                <div id="recent-events">
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π...</p>
                </div>
            </div>
        </div>
        
        <footer class="mt-4 text-center text-muted">
            <p>–ö—É—Ä—Å–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞ "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ Time-Tracker"</p>
            <p>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞ –Ω–∞ Render | Flask + PostgreSQL + SQLAlchemy</p>
        </footer>
    </div>
    
    <script>
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();
                
                document.getElementById('user-count').textContent = data.users;
                document.getElementById('category-count').textContent = data.categories;
                document.getElementById('event-count').textContent = data.events;
                document.getElementById('template-count').textContent = data.templates;
                
                // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É
                const table = document.getElementById('stats-table');
                table.innerHTML = `
                    <tr><td>users</td><td>${data.users}</td><td><span class="badge bg-success">‚úì</span></td></tr>
                    <tr><td>categories</td><td>${data.categories}</td><td><span class="badge bg-success">‚úì</span></td></tr>
                    <tr><td>events</td><td>${data.events}</td><td><span class="badge bg-success">‚úì</span></td></tr>
                    <tr><td>templates</td><td>${data.templates}</td><td><span class="badge bg-success">‚úì</span></td></tr>
                `;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
                loadRecentEvents();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }
        
        async function loadRecentEvents() {
            try {
                const response = await fetch('/api/recent-events');
                const events = await response.json();
                
                const container = document.getElementById('recent-events');
                if (events.length === 0) {
                    container.innerHTML = '<p>–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π</p>';
                    return;
                }
                
                let html = '<div class="list-group">';
                events.forEach(event => {
                    const date = new Date(event.start_time).toLocaleString('ru-RU');
                    const badgeColor = event.type === 'plan' ? 'primary' : 'success';
                    html += `
                        <div class="list-group-item">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <span class="badge bg-${badgeColor} me-2">${event.type}</span>
                                    ${date}
                                </div>
                                <div>${event.duration} –º–∏–Ω.</div>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
                container.innerHTML = html;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–±—ã—Ç–∏–π:', error);
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function createTestUser() {
            try {
                const response = await fetch('/api/create-test-user', { method: 'POST' });
                const result = await response.json();
                alert(result.message);
                loadStats(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            } catch (error) {
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
        async function createTestEvent() {
            try {
                const response = await fetch('/api/create-test-event', { method: 'POST' });
                const result = await response.json();
                alert(result.message);
                loadStats(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            } catch (error) {
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            }
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', loadStats);
        
        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
        setInterval(loadStats, 30000);
    </script>
</body>
</html>
