{% extends "base.html" %}

{% block title %}–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - Time Tracker{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-3">
        <div class="card">
            <div class="card-header">
                <h5>üë§ {{ current_user.username }}</h5>
            </div>
            <div class="card-body">
                <p>Telegram: 
                    {% if current_user.telegram_id %}
                        ‚úÖ {{ current_user.telegram_id }}
                    {% else %}
                        ‚ùå –ù–µ –ø—Ä–∏–≤—è–∑–∞–Ω
                    {% endif %}
                </p>
                <a href="/profile" class="btn btn-sm btn-outline-primary">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a>
            </div>
        </div>
        
        <div class="mt-3">
            <h6>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:</h6>
            <a href="/events/new" class="btn btn-success w-100 mb-2">‚ûï –ù–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ</a>
            <a href="/categories/new" class="btn btn-info w-100 mb-2">üè∑Ô∏è –ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è</a>
        </div>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="col-md-9">
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-white bg-primary">
                    <div class="card-body text-center">
                        <h4>{{ stats.categories }}</h4>
                        <p>–ö–∞—Ç–µ–≥–æ—Ä–∏–π</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-white bg-success">
                    <div class="card-body text-center">
                        <h4>{{ stats.events_today }}</h4>
                        <p>–°–æ–±—ã—Ç–∏–π —Å–µ–≥–æ–¥–Ω—è</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-white bg-info">
                    <div class="card-body text-center">
                        <h4>{{ stats.total_events }}</h4>
                        <p>–í—Å–µ–≥–æ —Å–æ–±—ã—Ç–∏–π</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-white bg-warning">
                    <div class="card-body text-center">
                        <h4>{{ stats.templates }}</h4>
                        <p>–®–∞–±–ª–æ–Ω–æ–≤</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è -->
        <div class="card">
            <div class="card-header">
                <h5>üìÖ –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è</h5>
            </div>
            <div class="card-body">
                {% if recent_events %}
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>–¢–∏–ø</th>
                                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                <th>–í—Ä–µ–º—è</th>
                                <th>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for event in recent_events %}
                            <tr>
                                <td>
                                    <span class="badge bg-{{ 'primary' if event.type == 'plan' else 'success' }}">
                                        {{ 'üìã –ü–ª–∞–Ω' if event.type == 'plan' else '‚úÖ –§–∞–∫—Ç' }}
                                    </span>
                                </td>
                                <td>
                                    <span class="category-color" style="background-color: {{ event.category.color }};"></span>
                                    {{ event.category.name }}
                                </td>
                                <td>{{ event.start_time.strftime('%H:%M') }}</td>
                                <td>{{ ((event.end_time - event.start_time).seconds // 60) }} –º–∏–Ω</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p class="text-muted">–£ –≤–∞—Å –µ—â–µ –Ω–µ—Ç —Å–æ–±—ã—Ç–∏–π. <a href="/events/new">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–µ!</a></p>
                {% endif %}
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                <h5>üè∑Ô∏è –í–∞—à–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h5>
            </div>
            <div class="card-body">
                {% if categories %}
                    <div class="d-flex flex-wrap">
                        {% for category in categories %}
                        <div class="category-badge me-2 mb-2" 
                             style="background-color: {{ category.color }}20; 
                                    border-left: 4px solid {{ category.color }}; 
                                    padding: 8px 12px; border-radius: 4px;">
                            {{ category.name }}
                            <small class="text-muted">({{ category.events|length }} —Å–æ–±—ã—Ç–∏–π)</small>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-muted">–£ –≤–∞—Å –Ω–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π. <a href="/categories/new">–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é!</a></p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
